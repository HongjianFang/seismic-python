from copy import deepcopy
import site
site.addsitedir('/opt/anf/5.6/lib/python')

import matplotlib.pyplot as plt

from seispy.core import demodb
from obspy.core import UTCDateTime

def test_gather():
    db = demodb()

    AZ_stations = db.vnet.subnets["AZ"].stations
    sta = AZ_stations['BZN']
    channel_sets = sta.get_orthogonal_channels(match="BH.*")

    starttime=UTCDateTime(year=1998,
                          julday=1,
                          hour=1,
                          minute=20)
    while starttime < UTCDateTime(year=1998,
                                  julday=1,
                                  hour=23):
        for channel_set in channel_sets:
            if channel_set.is_active(starttime=starttime,
                                     endtime=(starttime + 24)):
                gather = db.get_gather3c(sta,
                                         channel_set,
                                         starttime,
                                         starttime + 24)
                starttime += 24
                gather.filter("highpass", freq=3, zerophase=True)
                gather.detectS()
                if len(gather.detections) > 0:
                    gather.plot()
                    exit()

def test_trace():
    db = demodb()
    sta = "BZN"
    chan = "BHZ"
    time=UTCDateTime(year=1998,
                    julday=1,
                    hour=1,
                    minute=20)
    tend = UTCDateTime(year=1998,
                       julday=1,
                       hour=23,
                       minute=59,
                       second=59)
    flag = True
    while flag and time < tend:
        try:
            tr = db.get_trace(sta,
                            chan,
                            time,
                            time + 60)
            tr.detectS()
        except Exception:
            print "no pick made"
            time += 60
            continue
        flag = False

if __name__ == "__main__":
    test_gather()

